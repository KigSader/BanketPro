{% extends 'base.html' %}
{% block title %}Клиенты{% endblock %}
{% block content %}
<h1 class="h4 mb-3">Клиенты</h1>

<form class="row g-2 mb-3" method="get">
  <div class="col-12 col-md-3">
    <input class="form-control" name="q" placeholder="ФИО / телефон" value="{{ request.GET.q }}">
  </div>
  <div class="col-12 col-md-3">
    <input class="form-control" type="date" name="event_date" value="{{ request.GET.event_date }}" placeholder="Дата мероприятия">
  </div>
  <div class="col-12 col-md-2">
    <button class="btn btn-outline-secondary w-100">Искать</button>
  </div>
  <div class="col-12 col-md-4 text-md-end">
    <a class="btn btn-primary" href="{% url 'crm:client_create' %}">+ Добавить клиента</a>
  </div>
</form>

<table class="table table-sm align-middle bg-white">
  <thead>
    <tr>
      <th>ФИО</th>
      <th>Телефон</th>
      <th>Источник</th>
      <th>Создан</th>
      <th class="text-end">Мероприятий</th>
    </tr>
  </thead>
  <tbody>
    {% for c in object_list %}
      <tr>
        <td><a href="{% url 'crm:client_detail' c.pk %}">{{ c.full_name }}</a></td>
        <td><a href="tel:{{ c.phone }}">{{ c.phone }}</a></td>
        <td>{{ c.source|default:"—" }}</td>
        <td>{{ c.created_at|date:"d.m.Y H:i" }}</td>
        <td class="text-end">{{ c.event_count|default:"0" }}</td>
      </tr>
    {% empty %}
      <tr><td colspan="5" class="text-muted">Нет клиентов</td></tr>
    {% endfor %}
  </tbody>
</table>

{% include "_partials/pagination.html" with page_obj=page_obj %}
{% endblock %}
